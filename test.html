<html>

	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.16.2/lodash.js"></script>
		<script src="creature.js"></script>
		<script src="food.js"></script>
	</head>

	<body>

		<div id="world">

		</div>
		<input type="number" id="speed" value="1" onchange="setSpeed()"/>
		<button onclick="upSpeed()">faster</button>
		<button onclick="downSpeed()">slower</button>
	</body>
</html>
<script>
	'use strict';

	

	

	var creatures = []
	var foods = []
	var render = true;
    var pause = false
	var speed = 1;
	var ticks = 0;
	var world = {
		top : 50,
		bottom : 550,
		left : 50,
		right : 1050
	}


	var createCreatures = function(){
		_.range(0, 50).forEach(function () {
			creatures.push(creature())
		})

		creatures.forEach(function (creature) {
			creature.init()
		})
	}

	var createFoods = function(){
		_.range(0, 30).forEach(function () {
			foods.push(food())
		})

		foods.forEach(function (food) {
			food.init()
		})
	}

	function upSpeed(){
		speed = speed*2
		$('#speed').val(speed)
	}

	function downSpeed(){
		if(speed > 1){
			speed = Math.round(speed/2)
		}
		$('#speed').val(speed)
	}

	function setSpeed(){
		console.log('setting speed')
		speed = +$('#speed').val()
	}

	var isInsideWorld = function (creature) {
	    return world.left <= creature.x && world.right >= creature.x && world.top <= creature.y && world.bottom >= creature.y;
	}

	var isCollidingWith = function (el1, el2) {
		var min = Math.pow(el1.radius - el2.radius, 2)
	 	var pos = Math.pow(el1.x - el2.x, 2) +  Math.pow(el1.y - el2.y, 2)
		var max = Math.pow(el1.radius + el2.radius, 2)

		return (min <= pos && pos <= max)
	}

	function tick(){
		ticks ++;

		if(speed === 0 || pause){
			setTimeout(function () {
				tick()
			}, 100)
			return
		}


		creatures.forEach(function (creature) {
			creature.think();
			creature.move();
		});


		//console.log(ticks % speed)
		if(render && ticks % speed === 0){
			window.requestAnimationFrame(tick);
		}
		else {
			if(ticks % 100 === 0){
				setTimeout(function () {
					tick()
				})
			}
			else {
				tick()
			}
		}
	}

	$(document).keypress(function(e) {
	  if(e.which == 13) {
	    pause = !pause

	  }
	});

	setInterval(function () {
		console.log(ticks)
		ticks = 0
	}, 1000);

	createCreatures()
	createFoods()
	window.requestAnimationFrame(tick);

</script>
<style>
	body {
		
	}
	#world {
		background-color:lightblue;
		margin:50px;
		width:1000px;
		height:500px;
		background-size: 25px 25px;
	    background-image: linear-gradient(to right, grey 1px, transparent 1px), linear-gradient(to bottom, grey 1px, transparent 1px);
	}
	.creature {
		position:absolute;
		text-align:center;
		transform: translate3d(0, 0, 0);
		background-color:pink;
		border-radius: 99px;
		border-right:2px solid red;
		border-top: 0px solid purple;
		border-bottom: 0px solid purple;
	}
	.food {
		position:absolute;
		text-align:center;
		transform: translate3d(0, 0, 0);
		background-color:yellow;
		border : 1px solid orange;
		width:10px;
		height:10px;
		border-radius: 99px;
		left:5px;
		top:-5px;
	}
	.eye {
		position: absolute;
		width : 4px;
		height:  4px;
		background-color : black;
		border-radius: 99px;
		border-right:1px solid white;
	}

	.flagged {
		background-color: lightgrey;
	}
</style>